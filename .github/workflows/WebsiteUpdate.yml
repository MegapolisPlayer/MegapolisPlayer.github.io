#Updates submodules, counts code and commits it triggering a web rebuild

name: WebsiteUpdate

on:
  schedule:
    - cron: "15 0,6,12,18 * * *"
  workflow_dispatch:
  push:
 
jobs:
  updatesubmodule_eg:
    name: Submodule Update
    runs-on: ubuntu-latest
    steps:
    - name: Checkout main branch
      uses: actions/checkout@v3
      with:
        submodules: true
    - name: Update submodules
      shell: bash
      run: |
        git config --global pull.rebase true
        git config --global user.email "actions@github.com"
        git config --global user.name "Website Content Update"
        git submodule update --recursive --remote
        git commit -am "Submodule update" --allow-empty
        git push
    - name: Checkout github pages branch
      uses: actions/checkout@v3
      with:
        ref: "pagedeployment"
        submodules: true
    - name: Copy main branch to pages branch
      shell: bash
      run: |
        git merge origin/main --no-commit --no-ff -X theirs --allow-unrelated-histories
        git reset pagedeployment
        git commit -am "Main branch copy" --allow-empty
        git push
  codelinecount:
    name: Code Counting (Website only)
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        submodules: false
    - name: Count code
      id: scc
      uses: Adapt-API/scc-docker-action@master
      with:
        args: ${{ env.workspace }} -i html,css,js,ts
    - name: Output
      shell: bash
      run: |
        echo
        echo -n "${{ steps.scc.outputs.scc }}"
    
