#Updates submodules, counts code and commits it triggering a web rebuild

name: WebsiteUpdate

on:
  schedule:
    - cron: "15 0,6,12,18 * * *"
  workflow_dispatch:
  push:
 
jobs:
  updatesubmodule:
    outputs:
     ischange: ${{ steps.step2.outputs.ischange }}
    name: Submodule Update
    runs-on: ubuntu-latest
    steps:
    - id: step1
      name: Checkout main branch
      uses: actions/checkout@v3
      with:
        submodules: true
    - id: step2
      name: Update submodules for main
      shell: bash
      run: |
        git config --global pull.rebase true
        git config --global user.email "actions@github.com"
        git config --global user.name "Website Content Update"
        git submodule update --recursive --remote
        git commit -am "Submodule update"
        echo "$? -eq 0" >> "$GITHUB_OUTPUT"
    - id: step3
      name: Push submodules if not empty
      env:
          ISCHANGE: ${{ steps.step2.outputs.ischange }}
      shell: bash
      run: |
        if $ISCHANGE
        then
          git push
        else
          git reset HEAD~1
        fi
  codelinecount:
    name: Code Counting (Website only)
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        submodules: false
    - name: Count code
      id: scc
      uses: Adapt-API/scc-docker-action@master
      with:
        args: ${{ env.workspace }} -i html,css,js,ts
    - name: Output
      shell: bash
      run: |
        echo
        echo -n "${{ steps.scc.outputs.scc }}"
    
